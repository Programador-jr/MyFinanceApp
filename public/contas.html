<!DOCTYPE html>
<html lang="pt-br" data-bs-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="manifest" href="/manifest.webmanifest" />
  <meta name="theme-color" content="#111111" />
  <link rel="apple-touch-icon" href="/assets/icons/icon-192.png" />
  <title>MyFinance - Contas</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />
  <link href="assets/css/navbar.css" rel="stylesheet" />
  <link href="assets/css/contas.css" rel="stylesheet" />
  <link href="assets/css/light-mode.css" rel="stylesheet" />
</head>
<body>
  <div id="loadNavbar"></div>

  <div
    id="alert-container"
    class="position-fixed top-0 start-50 translate-middle-x mt-3"
    style="z-index: 1055; width: 90%; max-width: 420px;"
  ></div>

  <div class="modal fade" id="logoutConfirmModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            <i class="fa-solid fa-right-from-bracket text-danger me-2"></i>
            Confirmar saida
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <p>Tem certeza que deseja sair do MyFinance?</p>
          <p class="text-muted small">Você será desconectado e redirecionado para a página de login.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-success" data-bs-dismiss="modal">Cancelar</button>
          <button type="button" class="btn btn-danger" id="confirmLogout">Sair</button>
        </div>
      </div>
    </div>
  </div>

  <main class="container-xxl py-3 py-md-4">
    <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-3 mb-4">
      <h3 class="mb-0">
        <i class="fa-solid fa-wallet me-2"></i>Contas
      </h3>

      <div class="d-flex flex-column flex-sm-row gap-2">
        <button class="btn btn-primary contas-add-btn" id="openCreateAccountBtn" type="button">
          <i class="fa-solid fa-plus me-2"></i>Nova conta
        </button>
      </div>
    </div>

    <div class="row g-3 mb-4">
      <div class="col-12 col-md-4">
        <div class="contas-stat">
          <div class="label">Total gasto</div>
          <div class="value" id="summaryTotalValue">R$ 0,00</div>
        </div>
      </div>

      <div class="col-12 col-md-4">
        <div class="contas-stat">
          <div class="label">Em aberto</div>
          <div class="value" id="summaryOpenValue">R$ 0,00</div>
        </div>
      </div>

      <div class="col-12 col-md-4">
        <div class="contas-stat">
          <div class="label">Contas ativas</div>
          <div class="value" id="summaryActiveCount">0</div>
        </div>
      </div>
    </div>

    <section class="card contas-card">
      <div class="card-body p-3 p-md-4">
        <div class="row g-3 mb-3">
          <div class="col-12 col-md-7">
            <label class="form-label">Buscar conta</label>
            <input
              class="form-control"
              id="accountsSearchInput"
              type="text"
              placeholder="Ex: Cartao Nubank, Financiamento, Emprestimo..."
            />
          </div>

          <div class="col-12 col-md-3">
            <label class="form-label">Status</label>
            <select class="form-select" id="accountsStatusFilter">
              <option value="all">Todas</option>
              <option value="active">Ativas</option>
              <option value="paid">Concluidas</option>
            </select>
          </div>

          <div class="col-12 col-md-2 d-grid">
            <label class="form-label d-none d-md-block">&nbsp;</label>
            <button class="btn btn-outline-secondary" id="clearAccountsFiltersBtn" type="button">
              Limpar
            </button>
          </div>

          <div class="col-12">
            <div class="contas-view-toggle" role="group" aria-label="Visualização">
              <button class="btn contas-view-btn" id="accountsViewTableBtn" type="button">
                <i class="fa-solid fa-table me-2"></i>Tabela
              </button>
              <button class="btn contas-view-btn" id="accountsViewCardsBtn" type="button">
                <i class="fa-solid fa-grip me-2"></i>Cards
              </button>
            </div>
          </div>
        </div>

        <div class="table-responsive" id="accountsTableWrap">
          <table class="table table-striped align-middle mb-0">
            <thead>
              <tr>
                <th>Conta</th>
                <th>Parcelas/Ciclo</th>
                <th>Valor</th>
                <th>Próx. vencimento</th>
                <th>Entrada</th>
                <th>Total gasto</th>
                <th>Restante</th>
                <th>Categoria</th>
                <th>Status</th>
                <th class="text-end">Ações</th>
              </tr>
            </thead>
            <tbody id="accountsTable"></tbody>
          </table>
        </div>

        <div class="row g-3 d-none" id="accountsCardsView"></div>

        <div class="contas-empty d-none" id="accountsEmpty">
          <i class="fa-regular fa-folder-open"></i>
          <h6>Nenhuma conta encontrada</h6>
          <p class="mb-0">Ajuste os filtros para visualizar outras contas.</p>
        </div>
      </div>
    </section>
  </main>

  <div class="modal fade" id="accountEditorModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            <i class="fa-solid fa-wallet text-primary me-2"></i>
            <span id="accountEditorTitle">Nova conta</span>
          </h5>
          <button class="btn-close" data-bs-dismiss="modal" type="button"></button>
        </div>

        <div class="modal-body">
          <form id="accountEditorForm" class="row g-3">
            <div class="col-12">
              <label class="form-label">Nome da conta</label>
              <input id="accountNameInput" class="form-control" type="text" placeholder="Ex: Cartao principal" required />
            </div>

            <div class="col-12 col-md-6">
              <label class="form-label">Tipo</label>
              <select id="accountTypeSelect" class="form-select">
                <option value="installment">Conta parcelada</option>
                <option value="subscription">Servico por assinatura</option>
                <option value="fixed">Conta fixa</option>
              </select>
            </div>

            <div class="col-12 col-md-6 d-none" id="accountBillingCycleWrap">
              <label class="form-label">Cobrança</label>
              <select id="accountBillingCycleSelect" class="form-select">
                <option value="monthly">Mensal</option>
                <option value="annual">Anual</option>
              </select>
            </div>

            <div class="col-12 col-md-4" id="accountInstallmentValueWrap">
              <label class="form-label" id="accountInstallmentValueLabel">Valor da parcela</label>
              <input id="accountInstallmentValueInput" class="form-control" type="text" inputmode="decimal" autocomplete="off" data-money-mask="brl" required />
            </div>

            <div class="col-12 col-md-4" id="accountDownWrap">
              <label class="form-label">Valor de entrada (opcional)</label>
              <input id="accountDownInput" class="form-control" type="text" inputmode="decimal" autocomplete="off" data-money-mask="brl" />
            </div>

            <div class="col-12 col-md-4" id="accountInstallmentsWrap">
              <label class="form-label">Parcelas</label>
              <input id="accountInstallmentsInput" class="form-control" type="number" min="1" step="1" required />
            </div>

            <div class="col-12 col-md-6">
              <label class="form-label" id="accountFirstDueLabel">Data do primeiro pagamento</label>
              <input id="accountFirstDueInput" class="form-control" type="date" required />
            </div>

            <div class="col-12 col-md-6">
              <label class="form-label" id="accountNextDueLabel">Data da próxima cobrança</label>
              <input id="accountNextDueInput" class="form-control" type="date" required />
            </div>

            <div class="col-12">
              <label class="form-label">Categoria vinculada (editavel)</label>
              <select id="accountCategorySelect" class="form-select"></select>
              <div class="form-text">Se deixar em branco, sera solicitada na primeira vez que clicar em pagar.</div>
            </div>
          </form>

          <div class="contas-preview mt-3">
            <div>
              <span id="accountTotalPreviewLabel">Total contabilizado</span>
              <strong id="accountTotalPreview">R$ 0,00</strong>
            </div>
            <div>
              <span id="accountInstallmentPreviewLabel">Valor da parcela</span>
              <strong id="accountInstallmentPreview">R$ 0,00</strong>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal" type="button">Cancelar</button>
          <button class="btn btn-success" id="saveAccountBtn" type="button">
            <i class="fa-solid fa-check me-2"></i>Salvar
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="payAccountModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            <i class="fa-solid fa-money-check-dollar text-success me-2"></i>Pagar conta
          </h5>
          <button class="btn-close" data-bs-dismiss="modal" type="button"></button>
        </div>

        <div class="modal-body">
          <div class="pay-summary">
            <div>
              <span>Conta</span>
              <strong id="payAccountName">-</strong>
            </div>
            <div>
              <span id="payCycleInfoLabel">Parcela</span>
              <strong id="payInstallmentInfo">-</strong>
            </div>
            <div>
              <span>Valor a pagar</span>
              <strong id="payInstallmentValue">R$ 0,00</strong>
            </div>
            <div>
              <span id="payNextDueLabel">Vencimento</span>
              <strong id="payNextDueDate">-</strong>
            </div>
          </div>

          <div class="mt-3 d-none" id="payCategorySelectWrap">
            <label class="form-label">Categoria da conta (sera lembrada)</label>
            <select id="payCategorySelect" class="form-select"></select>
          </div>

          <div class="mt-3 d-none" id="payCategoryFixedWrap">
            <label class="form-label mb-1">Categoria vinculada</label>
            <div class="pay-fixed-category" id="payCategoryFixedText">-</div>
          </div>
        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal" type="button">Cancelar</button>
          <button class="btn btn-success" id="confirmPayBtn" type="button">
            <i class="fa-solid fa-check me-2"></i>Pagar
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="deleteAccountModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            <i class="fa-solid fa-triangle-exclamation text-danger me-2"></i>Excluir conta
          </h5>
          <button class="btn-close" data-bs-dismiss="modal" type="button"></button>
        </div>

        <div class="modal-body">
          <p>Tem certeza que deseja excluir esta conta?</p>
          <p class="text-muted small mb-0">Essa ação remove o cadastro da conta, mas não remove lançamentos já pagos.</p>
        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal" type="button">Cancelar</button>
          <button class="btn btn-danger" id="confirmDeleteAccountBtn" type="button">Excluir</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="adjustSubscriptionModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            <i class="fa-solid fa-arrow-trend-up text-warning me-2"></i>Reajustar assinatura
          </h5>
          <button class="btn-close" data-bs-dismiss="modal" type="button"></button>
        </div>

        <div class="modal-body">
          <div class="contas-preview">
            <div>
              <span>Assinatura</span>
              <strong id="adjustAccountName">-</strong>
            </div>
            <div>
              <span>Valor atual</span>
              <strong id="adjustCurrentValue">R$ 0,00</strong>
            </div>
          </div>

          <div class="mt-3">
            <label class="form-label">Novo valor</label>
            <input id="adjustNewValueInput" class="form-control" type="text" inputmode="decimal" autocomplete="off" data-money-mask="brl" />
          </div>

          <div class="mt-3">
            <label class="form-label">Data do reajuste</label>
            <input id="adjustDateInput" class="form-control" type="date" />
          </div>

          <div class="mt-3">
            <label class="form-label">Observação (opcional)</label>
            <input id="adjustNoteInput" class="form-control" type="text" maxlength="120" placeholder="Ex: reajuste anual do servico" />
          </div>
        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal" type="button">Cancelar</button>
          <button class="btn btn-warning" id="confirmAdjustSubscriptionBtn" type="button">
            <i class="fa-solid fa-check me-2"></i>Aplicar reajuste
          </button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/config.js"></script>
  <script src="js/api.js"></script>
  <script src="js/pwa.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/idleLogout.js"></script>
  <script src="js/loadNavbar.js"></script>
  <script src="js/profileMenu.js"></script>
  <script src="js/contas.js"></script>
</body>
</html>
